<!--
 * @Author: joker.zhang
 * @Date: 2021-06-29 17:30:01
 * @LastEditors: joker.zhang
 * @LastEditTime: 2021-06-30 09:57:01
 * @mail: zhanghua7890@163.com
 * @Description: For Automation
-->
## 性能测试
* [参考](https://www.cnblogs.com/puresoul/p/5456855.html)
* 软件性能：是软件的一种非功能特性，它关注的不是软件是否能够完成特定的功能，而是在完成该功能时展示出来的及时性
* 性能测试：指通过自动化的测试工具模拟多种正常、峰值以及异常负载条件来对系统的各项性能指标进行测试。

## 性能测试类型
* 基准测试：在给系统施加较低压力时，查看系统的运行状况并记录相关数做为基础参考
* 负载测试：是指对系统不断地增加压力或增加一定压力下的持续时间，直到系统的某项或多项性能指标达到安全临界值
* 压力测试：压力测试是评估系统处于或超过预期负载时系统的运行情况，关注点在于系统在峰值负载或超出最大载荷情况下的处理能力
* 稳定性测试：在给系统加载一定业务压力的情况下，使系统运行一段时间，以此检测系统是否稳定
* 并发测试：测试多个用户同时访问同一个应用、同一个模块或者数据记录时是否存在死锁或者其他性能问题

## 负载测试和压力测试的区别
* 负载测试是站在用户的角度去观察一定条件下软件系统的性能表现，压力测试可能要远远高于用户的性能需求
* 负载测试的预期结果是用户的性能需求得到满足，而压力测试的预期结果是系统出现问题
* 负载测试关心用户的规则和需求，压力测试关心软件系统本身的能力

## 性能测试的应用场景
| --- | 主要用途|典型场景|特点|测试方法|
|---|---|---|---|---|
| 能力验证 | 关注在给定的软硬件条件下，系统能否具有预期的能力表现|在要求平均响应时间小于2秒的前提下，如何判断系统是否能够支持50万用户/天的访问量？|a要求在已确定的环境下运行<br>b需要根据典型场景设计测试方案和用例，包括操作序列和并发用户量，需要明确的性能目标。|a负载测试<br>b压力测试<br>c稳定性测试|
|规划能力|关注如何使系统具有我们要求的性能能力|系统计划在一年内获客量在到xxx万，系统到时候是否能支持这么多用户量？如果不能需要如何调整系统的配置？|a它是一种探索性的测试<br>b常用于了解系统性能和获得扩展性能的方法|a负载测试<br>b压力测试<br>c配置测试|
|性能调优|主要用于对系统性能进行调优|系统上线运行一段时间后响应速度越来越慢，此时应该如何办？|每次只改变一个配置，切忌无 休止的调优|a并发测试<br>b压力测试<br>c配置测试|
|缺陷发现|发现缺陷或问题重现、定位手段|某些缺陷只有在高负载的情况下才能暴露出来，如线程锁、资源竞争或内存泄露。|做为系统测试的补充，用来发现并发问题，或是对系统已经出现的问题进行重现和定位|a并发测试<br>b压力测试|
|性能基准比较|常用于敏捷开发过程中，敏捷开发流程的特点是小步快走，快速试错，迭代周期短，需求变化频繁。很难定义完善的性能测试目标，也没有时间在每个迭代开展详细的性能测试，可以通过建立性能基线，通过比较每次迭代中的性能表现变化，判断迭代是否达到了目标。|---|---|---|

## 性能测试-响应时间
* 定义：从用户发送一个请求到用户接收到服务器返回的响应数据这段时间就是响应时间
* 计算方法：Response time = 网络传输时间 + 服务器（应用程序）处理时间
* 响应时间-负载对应关系：负载越大，响应时间基本不变，达到拐点后，响应时间急剧增大
a）响应时间突然增加<br>
b）意味着系统的一种或多种资源利用达到的极限<br>
c）通常可以利用拐点来进行性能测试分析与定位<br>

## 性能测试-吞吐量
* 定义：单位时间内系统处理的客户端请求的数量
* 计算单位：一般使用请求数／秒做为吞吐量的单位，出可以使用 页面数／秒表表示。从业务角度来说也可以使用 访问人数 /天 或 页面访问量／天 做为单位
* 计算方法：Throughput = (number of requests) / (total time)
* 资源利用-负载对应关系：负载越大，吞吐量逐渐增大，达到拐点后，急剧下降后达到饱和
a）吞吐量逐渐达到饱和<br>
b）意味着系统的一种或多种资源利用达到的极限<br>
c）通常可以利用拐点来进行性能测试分析与定位<br>

## 性能测试-资源利用率
* 定义：指的是对不同系统资源的使用程度，通常以占用最大值的百分比来衡量
* 服务器资源：CPU、内存、磁盘IO、网络宽带、数据库连接数、数据库读写时长、缓存吞吐量
* 资源利用-负载对应关系：负载越大，资源利用率逐渐增大，达到拐点后变成饱和不变
a）服务器某荐资源使用逐渐达到饱和<br>
b）通常可以利用拐点来进行性能测试分析与定位<br>

## 性能测试-其他概念
* 并发用户数：某一物理时刻同时向系统提交请求的用户数，提交的请求可能是同一个场景或功能，也可以是不同场景或功能。
* 最佳并发用户数：响应时间未到拐点，吞吐量和资源利用率刚达到（拐点）饱和时的并发用户数
* 最大并发用户数：响应时间刚到拐点，吞吐量下降，资源利用率饱和时的并发用户数
* 在线用户数：某段时间内访问系统的用户数，这些用户并不一定同时向系统提交请求
* 系统用户数：系统注册的总用户数据
* TPS：Transactions Per Second，每秒事务数
* 思考时间：用户每个操作后的暂停时间，或者叫操作之间的间隔时间，此时间内是不对服务器产生压力的
* 点击数：每秒钟用户向WEB服务器提交的HTTP请求数。这个指标是WEB应用特有的一个指标:WEB应用是"请求-响应"模式,用户发出一次申请,服务器就要处理一次，所以点击是WEB应用能够处理的交易的最小单位。如果把每次点击定义为一个交易，点击率和TPS就是一个概念。容易看出，点击率越大，对服务器的压力越大
* PV：访问一个URL，产生一个PV（Page View，页面访问量），每日每个网站的总PV量是形容一个 网站规模的重要指标
* UV：作为一个独立的用户，访问站点的所有页面均算作一个UV（Unique Visitor，用户访问）
* [理发店模型](https://www.cnblogs.com/jackei/archive/2006/11/20/565527.html)
* [地铁模型](https://www.cnblogs.com/puresoul/p/5458734.html)

## 你如何制定性能测试方案
* why 为什么要做性能测试？或者性能测试能解决业务上什么痛点？或者希望性能测试能发现什么用户使用上的问题？
* what 确定具体测试哪些业务、哪些数据库、哪些接口、程序架构等，整理出业务场景表
* where 确定测试的环境，是测试/仿真/线下环境？确定系统信息、硬件信息，服务器信息
* how 如何去做？经过成本的综合考虑，使用哪些测试工具（jmeter/LR/locust/OpenSTA）,选取什么性能测试方法（压力/负载/稳定性等）
* who 性能测试团队，包括DBA、系统开发人员（前后端）支持、性能测试设计分析人员（需求收集人员）、脚本开发/执行人员，有经验的负责人（各方面培训）
* when 一般而言，只有在系统基础功能测试验证完成，相对稳定的情况下，才会考虑性能测试，所以都准备好了，就可以预计性能测试各模块的起止时间

## 什么样才是符合性能需求

不能让用户明显感觉慢
* 页面长时间不动---响应时间长
* 系统用着用着就闪退/崩溃/卡顿----不稳定

所以，个人理解
* 页面跳转响应时间不能超过2秒
* 文件上传、下载不超过8秒
* 服务器cpu平均使用率小于80%
* 服务器内存平均使用率小于70%
* 系统长时间使用不能出现卡顿，闪退，更不能出现崩溃


## 如何判断是否内存泄漏

## 查看服务器性能的命令
* CPU监控 top、uptime、dstat
* 内存监控 free、vmstat、dstat
* 磁盘监控 iostat、iotop、df、dstat
* 网络监控 ifstat、dstat